# isoc::firewall
Этот класс позволяет экспортировать и импортировать правила для фаервола между нодами. При этом создание правил делается на необходимой ноде

## Открываем доступ между ролями
есть ноды A1 и A2 (role: frontend) и B (role: backend), все в организации org1. Нужно открыть порт 8080 на бэкэнде для всех хостов в роли frontend.
org1.yaml
```yaml
classes:
  - isoc
isoc::use_firewall: true
```
frontend.yaml
```yaml
firewalls_export:
  "500 allow http access from %{role} for %{fqdn}":  # тут %{fqdn} нужно обязательно указывать, иначе столкнетесь с Duplicate declaration
    proto: tcp
    action: accept
    dport:
      - '8080'
    tag:
      - "org_%{organization}" # Обязательно указываем данную конструкцию, чтобы правило применилось
      - "role_backend"        # Указываем роль, в которой необходимо применить данное правило
```

После работы паппета на нодах A1 и A2, а затем на ноде B появится 2 правила, разрешающее подключение с нод A1 и A2. А если ноду A1 удалим из puppet (командой `puppet node deactivate A1`), то разрешающее правило тоже удалится из фаервола.

